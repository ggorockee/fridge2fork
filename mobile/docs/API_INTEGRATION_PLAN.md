# Fridge2Fork API 연동 계획서

## 📋 개요

현재 개발된 Fridge2Fork 앱의 디자인과 기능을 절대 해치지 않으면서, 실제 Fridge2Fork Admin API를 단계적으로 연동하는 계획서입니다.

## 🎯 연동 목표

1. **기존 디자인 보존**: 현재 UI/UX 디자인을 완전히 유지
2. **점진적 연동**: 단계별로 API를 연동하여 안정성 확보
3. **향후 확장성**: 인증 시스템 추가 시에도 대응 가능한 구조
4. **사용자 경험 향상**: 실제 데이터로 더 나은 레시피 추천 제공

## 📊 현재 앱 구조 분석

### 기술스택
- **상태관리**: Riverpod 최우선 적용 - 모든 API 상태를 Riverpod으로 관리
- **사용자경험개선**: Firebase Analytics 및 Crashlytics로 사용자 경험 데이터 수집 및 관리
- **백엔드 추천로직**: 개발이 완료되지 않았으므로, 현재는 로컬 데이터로 임시 추천 제공

### 화면 구조
- **SplashScreen**: 앱 시작 화면
- **MainScreen**: 하단 네비게이션 (홈, 내 냉장고, 레시피 검색, 마이페이지)
- **HomeScreen**: 냉장고 요약 및 추천 레시피
- **MyFridgeScreen**: 식재료 관리
- **RecipeDetailScreen**: 레시피 상세 정보
- **AddIngredientScreen**: 식재료 추가

### 현재 데이터 구조
- **API 기반**: 환경별 API 서버에서 모든 데이터 로드
  - **개발**: `https://admin-api-dev.woohalabs.com/fridge2fork/v1`
  - **운영**: `https://admin-api.woohalabs.com/fridge2fork/v1`
- **로컬 캐시**: SharedPreferences 및 로컬 캐시로 오프라인 지원
- **폴백 데이터**: API 실패 시 기본 샘플 데이터 제공

## 🚀 단계별 API 연동 계획


### Phase 1: 인프라 구축 (1-2주)

#### 1.1 API 서비스 레이어 구축
- **API 클라이언트**: HTTP 클라이언트 설정 및 관리
- **엔드포인트 관리**: API 엔드포인트 상수 정의
- **인터셉터**: 요청/응답 인터셉터 구현
- **식재료 API 서비스**: 식재료 관련 API 호출
- **레시피 API 서비스**: 레시피 관련 API 호출
- **시스템 API 서비스**: 시스템 정보 API 호출

#### 1.2 데이터 모델 확장
- **API 식재료 모델**: API 응답을 위한 식재료 데이터 구조
- **API 레시피 모델**: API 응답을 위한 레시피 데이터 구조
- **공통 API 응답 모델**: 표준화된 API 응답 형식
- **API 에러 모델**: 에러 응답 처리 모델

#### 1.3 상태 관리 개선 (Riverpod 중심)
- **API 연결 상태 관리**: Riverpod StateNotifier로 API 연결 상태 추적
- **식재료 API 상태 관리**: AsyncValue를 활용한 로딩/에러/데이터 상태 관리
- **레시피 API 상태 관리**: Riverpod Provider로 레시피 데이터 캐싱 및 관리
- **Firebase Analytics 연동**: API 호출 및 사용자 행동 추적을 위한 이벤트 로깅

### Phase 2: 식재료 관리 API 연동 (2-3주)

#### 2.1 식재료 목록 API 연동
- **대상 화면**: `AddIngredientScreen`
- **API 엔드포인트**: `GET /fridge2fork/v1/ingredients/`
- **기존 동작 유지**: 로컬 카테고리 구조는 그대로 유지
- **개선 사항**: 실제 API에서 식재료 목록을 가져와 더 정확한 데이터 제공

#### 2.2 식재료 정규화 기능 연동
- **대상 기능**: 식재료 추가 시 중복/모호한 식재료 처리
- **API 엔드포인트**: `GET /fridge2fork/v1/ingredients/normalization/suggestions`
- **사용자 경험**: 식재료 추가 시 자동으로 정규화 제안 표시

#### 2.3 구현 계획
- **식재료 목록 조회**: 검색, 필터링, 페이지네이션 기능 포함
- **정규화 제안**: 중복/모호한 식재료에 대한 자동 제안 기능
- **에러 처리**: 네트워크 오류 시 로컬 데이터 폴백
- **캐싱**: 자주 사용되는 식재료 목록 로컬 캐시

### Phase 3: 레시피 API 연동 (3-4주)

#### 3.1 레시피 목록 API 연동
- **대상 화면**: `HomeScreen` (추천 레시피), `RecipeListScreen`
- **API 엔드포인트**: `GET /fridge2fork/v1/recipes/`
- **API 우선**: 모든 레시피 데이터를 API에서 로드
- **개선 사항**: 실제 레시피 데이터로 더 다양한 추천 제공
- **임시 추천 로직**: 백엔드 추천 시스템 완성 전까지 클라이언트 사이드 추천 로직 사용

#### 3.2 레시피 상세 API 연동
- **대상 화면**: `RecipeDetailScreen`
- **API 엔드포인트**: `GET /fridge2fork/v1/recipes/{recipe_id}`
- **식재료 API**: `GET /fridge2fork/v1/recipes/{recipe_id}/ingredients`
- **기존 동작 유지**: 조리법 단계별 UI는 그대로 유지
- **개선 사항**: 실제 이미지, 정확한 재료 정보 제공

#### 3.3 레시피 검색 API 연동
- **대상 화면**: `RecipeListScreen`
- **API 엔드포인트**: `GET /fridge2fork/v1/recipes/?search=`
- **기존 동작 유지**: 검색 UI는 그대로 유지
- **개선 사항**: 실제 레시피 데이터베이스에서 검색
- **실시간 검색**: API 기반 실시간 검색 결과 제공

### Phase 4: 시스템 모니터링 및 최적화 (1-2주)

#### 4.1 헬스체크 API 연동
- **목적**: API 서버 상태 모니터링
- **API 엔드포인트**: `GET /fridge2fork/v1/health`
- **사용**: 앱 시작 시 API 상태 확인

#### 4.2 Firebase Analytics 및 모니터링 강화
- **API 성능 추적**: 각 API 엔드포인트의 응답 시간 및 성공률 모니터링
- **사용자 행동 분석**: 레시피 조회, 식재료 추가 등 사용자 행동 패턴 분석
- **에러 추적**: Firebase Crashlytics로 API 관련 에러 자동 수집
- **사용자 경험 지표**: 화면 로딩 시간, API 호출 빈도 등 UX 지표 수집

#### 4.3 에러 처리 및 오프라인 지원
- **오프라인 모드**: API 연결 실패 시 로컬 데이터 사용
- **에러 핸들링**: 사용자 친화적인 에러 메시지
- **재시도 로직**: 네트워크 오류 시 자동 재시도
- **Firebase 에러 리포팅**: 모든 API 에러를 Firebase로 자동 전송

### Phase 5: 향후 인증 시스템 대비 (준비 단계)

#### 5.1 인증 인터페이스 설계
- **토큰 조회**: 액세스 토큰을 가져오는 인터페이스
- **토큰 갱신**: 만료된 토큰을 갱신하는 인터페이스
- **로그아웃**: 사용자 로그아웃 처리 인터페이스

#### 5.2 API 요청 헤더 관리
- **기본 헤더**: Content-Type 등 기본 HTTP 헤더 설정
- **인증 헤더**: Authorization Bearer 토큰 자동 추가
- **동적 헤더**: 요청에 따라 동적으로 헤더 설정

## 🔧 기술적 구현 방안

### 1. API 클라이언트 설정

- **베이스 URL**: 환경별 API 서버 URL
  - **개발**: `https://admin-api-dev.woohalabs.com/fridge2fork/v1`
  - **운영**: `https://admin-api.woohalabs.com/fridge2fork/v1`
- **환경 설정**: 개발/운영 환경 분리 지원 (dev/prod)
- **타임아웃 설정**: 연결 및 응답 타임아웃 10초
- **인터셉터**: 요청/응답 로깅 및 에러 처리
- **초기화**: 앱 시작 시 API 클라이언트 설정

### 2. 데이터 모델 매핑

- **API 레시피 → 앱 레시피**: API 응답을 앱 내부 모델로 변환
- **API 식재료 → 앱 식재료**: API 식재료 데이터를 앱 형식으로 변환
- **기본값 설정**: API에서 제공하지 않는 필드에 대한 기본값 설정
- **타입 변환**: API 데이터 타입을 앱에서 사용하는 타입으로 변환

### 3. 상태 관리 개선 (Riverpod 중심)

- **로딩 상태 관리**: AsyncValue.loading()으로 API 호출 중 로딩 상태 표시
- **성공 상태 처리**: AsyncValue.data()로 API 응답 데이터를 상태에 저장
- **에러 상태 처리**: AsyncValue.error()로 네트워크 오류 시 로컬 데이터로 폴백
- **오프라인 지원**: API 실패 시 기존 로컬 데이터 사용
- **Firebase 이벤트 로깅**: API 호출 성공/실패를 Firebase Analytics로 추적

## 🛡️ 디자인 보존 전략

### 1. UI 컴포넌트 분리
- **기존 위젯 유지**: 모든 커스텀 위젯은 그대로 유지
- **데이터 소스만 변경**: UI 로직은 변경하지 않고 데이터 소스만 API로 변경
- **점진적 교체**: 로컬 데이터와 API 데이터를 병행 사용

### 2. 사용자 경험 일관성
- **로딩 상태**: API 호출 시 기존 로딩 UI 사용
- **에러 처리**: 네트워크 오류 시 기존 에러 처리 방식 유지
- **오프라인 지원**: API 실패 시 로컬 데이터로 폴백

### 3. 성능 최적화
- **캐싱**: API 응답 데이터를 로컬에 캐시
- **페이지네이션**: 대량 데이터 로드 시 페이지네이션 적용
- **이미지 최적화**: API 이미지 URL을 효율적으로 처리

## 📱 화면별 연동 계획

### HomeScreen
- **API 호출**: `GET /fridge2fork/v1/recipes/`로 추천 레시피 로드
- **사용자 맞춤**: 사용자 식재료 기반 레시피 추천 (백엔드 로직 완성 전까지 로컬 로직)
- **유지**: UI 레이아웃, 식재료 추가 버튼, 광고 배치

### MyFridgeScreen
- **현재**: SharedPreferences에서 식재료 저장/로드
- **변경**: API를 통한 식재료 동기화 (향후)
- **유지**: 카테고리별 그룹핑, 삭제 기능, 우선 소진 기능

### AddIngredientScreen
- **API 호출**: `GET /fridge2fork/v1/ingredients/`로 실제 식재료 목록 로드
- **정규화 제안**: `GET /fridge2fork/v1/ingredients/normalization/suggestions` 연동
- **유지**: 카테고리 드롭다운, 그리드 레이아웃, 선택 UI

### RecipeDetailScreen
- **API 호출**: `GET /fridge2fork/v1/recipes/{recipe_id}`로 레시피 상세 정보 로드
- **식재료 정보**: `GET /fridge2fork/v1/recipes/{recipe_id}/ingredients`로 재료 목록 로드
- **유지**: 조리법 단계별 UI, 재료 표시, "만들었어요" 버튼

## 🔐 향후 인증 시스템 고려사항

### 1. 토큰 관리
- **토큰 저장**: 액세스 토큰과 리프레시 토큰을 안전하게 저장
- **토큰 조회**: API 호출 시 저장된 토큰을 자동으로 가져오기
- **토큰 갱신**: 만료된 토큰을 자동으로 갱신
- **보안**: 토큰을 암호화하여 저장

### 2. 자동 토큰 갱신
- **401 에러 감지**: 토큰 만료 시 자동으로 감지
- **자동 갱신**: 리프레시 토큰으로 새 액세스 토큰 발급
- **요청 재시도**: 갱신 후 원래 요청을 자동으로 재시도
- **에러 처리**: 갱신 실패 시 로그인 화면으로 리다이렉트

### 3. 사용자 데이터 동기화
- **개인화된 추천**: 사용자별 식재료 기반 레시피 추천
- **사용 이력**: 레시피 조회, 즐겨찾기 등 사용자 행동 추적
- **설정 동기화**: 앱 설정을 클라우드에 저장

## 📊 성공 지표

### 1. 기술적 지표
- **API 응답 시간**: 평균 2초 이내
- **오류율**: 1% 이하
- **오프라인 지원**: API 실패 시 100% 로컬 데이터 사용
- **Firebase 연동율**: 모든 주요 사용자 행동의 95% 이상 추적

### 2. 사용자 경험 지표
- **앱 크래시율**: 0.1% 이하 유지 (Firebase Crashlytics 모니터링)
- **화면 로딩 시간**: 기존과 동일한 수준 유지
- **사용자 만족도**: 기존 기능의 사용성 유지
- **Firebase Analytics 이벤트**: API 호출, 레시피 조회, 식재료 추가 등 핵심 이벤트 추적

### 3. 비즈니스 지표
- **레시피 추천 정확도**: 실제 API 데이터로 향상
- **사용자 참여도**: 더 정확한 추천으로 증가
- **데이터 품질**: 식재료 정규화로 개선

## 🚨 주의사항 및 리스크 관리

### 1. 기술적 리스크
- **API 서버 다운**: 오프라인 모드로 대응
- **네트워크 지연**: 로딩 상태 표시 및 타임아웃 처리
- **데이터 불일치**: 로컬 데이터와 API 데이터 동기화 전략

### 2. 사용자 경험 리스크
- **기존 기능 손상**: 철저한 테스트로 방지
- **성능 저하**: 캐싱 및 최적화로 대응
- **UI 변경**: 기존 디자인 완전 보존

### 3. 개발 리스크
- **일정 지연**: 단계별 연동으로 리스크 분산
- **품질 저하**: 각 단계별 코드 리뷰 및 테스트
- **유지보수성**: 명확한 코드 구조 및 문서화

## 📅 개발 일정

| Phase | 기간 | 주요 작업 | 완료 기준 |
|-------|------|-----------|-----------|
| Phase 1 | 1-2주 | API 인프라 구축 | API 클라이언트, Riverpod 상태관리, Firebase Analytics 연동 완성 |
| Phase 2 | 2-3주 | 식재료 API 연동 | 식재료 목록 API 연동 및 Firebase 이벤트 추적 완료 |
| Phase 3 | 3-4주 | 레시피 API 연동 | 레시피 API 연동 및 사용자 행동 분석 완료 |
| Phase 4 | 1-2주 | 모니터링 및 최적화 | Firebase 모니터링 강화 및 성능 최적화 완료 |
| Phase 5 | 준비 단계 | 인증 시스템 대비 | 인증 인터페이스 설계 및 Firebase 인증 준비 완료 |

**총 예상 기간**: 7-11주

## 🎯 다음 단계

1. **Phase 1 시작**: API 클라이언트 및 데이터 모델 구축
2. **테스트 환경 구축**: 개발용 API 서버 연결
3. **점진적 연동**: 식재료 API부터 단계적 연동 시작
4. **사용자 테스트**: 각 단계별 사용자 피드백 수집
5. **최적화**: 성능 및 사용자 경험 개선

이 계획서를 바탕으로 기존 디자인을 완전히 보존하면서도 실제 API 데이터의 장점을 활용할 수 있는 강력한 앱을 구축할 수 있습니다.
