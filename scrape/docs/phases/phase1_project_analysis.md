# Phase 1: 프로젝트 분석 및 현황 파악

## 진행상황

- [x] CSV 데이터 구조 분석 완료
- [x] 기존 시스템 구성요소 확인 완료
- [x] SQLAlchemy 모델 분석 완료
- [x] 재료 파싱 시스템 분석 완료
- [x] CSV 마이그레이션 시스템 확인 완료
- [x] 기술 스택 선정 완료
- [x] 데이터 처리 전략 수립 완료

## 개요

CSV 데이터를 정규화하여 PostgreSQL 데이터베이스에 저장하고, 데이터 구조 관리 시스템을 구축하는 프로젝트의 첫 번째 단계입니다.

## 프로젝트 목표

한국 레시피 CSV 데이터를 정규화하여 PostgreSQL 데이터베이스에 저장하는 단순한 데이터 마이그레이션 시스템

## 데이터 현황 분석

### CSV 데이터 구조

| 컬럼명 | 설명 | 예시 |
|--------|------|------|
| RCP_SNO | 레시피일련번호 | 128671 |
| RCP_TTL | 레시피제목 | 어묵김말이 |
| CKG_NM | 요리명 | 어묵김말이 |
| RGTR_ID | 등록자ID | skfo0701 |
| RGTR_NM | 등록자명 | 꽃날 |
| INQ_CNT | 조회수 | 9592 |
| RCMM_CNT | 추천수 | 6 |
| SRAP_CNT | 스크랩수 | 66 |
| CKG_MTH_ACTO_NM | 요리방법별명 | 튀김 |
| CKG_STA_ACTO_NM | 요리상황별명 | 간식 |
| CKG_MTRL_ACTO_NM | 요리재료별명 | 가공식품류 |
| CKG_KND_ACTO_NM | 요리종류별명 | 디저트 |
| CKG_IPDC | 요리소개 | 맛있는 김말이에 쫄깃함을 더한... |
| CKG_MTRL_CN | **요리재료내용** | [재료] 어묵 2개\| 김밥용김 3장\| ... |
| CKG_INBUN_NM | 요리인분명 | 2인분 |
| CKG_DODF_NM | 요리난이도명 | 초급 |
| CKG_TIME_NM | 요리시간명 | 60분이내 |
| FIRST_REG_DT | 최초등록일시 | 20070402131403 |

### 핵심 정규화 대상: CKG_MTRL_CN (요리재료내용)

**원본 형태:**
```
[재료] 어묵 2개| 김밥용김 3장| 당면 1움큼| 양파 1/2개| 당근 1/2개| 깻잎 6장| 튀김가루 1컵 | 올리브유 적당량| 간장 1T| 참기름 1T
```

**정규화 목표:**
| 재료 | 수량 | 단위 | 모호여부 |
|------|------|------|----------|
| 어묵 | 2 | 개 | False |
| 김밥용김 | 3 | 장 | False |
| 당면 | 1 | 움큼 | False |
| 양파 | 0.5 | 개 | False |
| 당근 | 0.5 | 개 | False |
| 깻잎 | 6 | 장 | False |
| 튀김가루 | 1 | 컵 | False |
| 올리브유 | - | - | True (적당량) |
| 간장 | 1 | T | False |
| 참기름 | 1 | T | False |

## 기존 시스템 분석 결과

### ✅ 이미 완성된 구성 요소

1. **SQLAlchemy 모델 (app/models/recipe.py)**
   - Recipe: 레시피 기본 정보
   - Ingredient: 재료 마스터 테이블
   - RecipeIngredient: 레시피-재료 연결 테이블

2. **재료 파싱 시스템 (app/utils/ingredient_parser.py)**
   - 한국어 재료 텍스트 파싱
   - 분수 처리 (1/2, 1/4 등)
   - 모호한 표현 처리 (적당량, 약간 등)
   - 단위 정규화 (큰술→Tbsp, 티스푼→tsp 등)
   - 재료명 정규화 (대파→파, 다진마늘→마늘 등)

3. **CSV 마이그레이션 시스템 (scripts/migrate_csv_data.py)**
   - 인코딩 자동 감지 (EUC-KR, UTF-8 등)
   - 청크 기반 배치 처리
   - UPSERT 로직 (중복 데이터 안전 처리)
   - 트랜잭션 안전성 보장

4. **Alembic 마이그레이션 설정**
   - 환경변수 기반 DATABASE_URL 자동 구성
   - 모델 자동 감지 및 스키마 생성

## 데이터 처리 전략

### 모호한 표현 처리 방안

| 표현 | 처리 방식 | 데이터베이스 저장 |
|------|-----------|-------------------|
| 적당량 | is_vague=True | quantity_text="적당량" |
| 약간 | is_vague=True | quantity_text="약간" |
| 조금 | is_vague=True | quantity_text="조금" |
| 1/2개 | quantity_from=0.5 | unit="개" |
| 1~2컵 | quantity_from=1, quantity_to=2 | unit="컵" |
| 1T | quantity_from=1 | unit="Tbsp" |

### 재료 검색 최적화

1. **정규화된 재료명 사용**
   - 사용자 입력: "대파" → 정규화: "파"
   - 검색 범위 확대 및 정확도 향상

2. **카테고리 기반 분류**
   - 육류, 해산물, 채소류, 양념류 등
   - 재료 추천 및 대체재 제안 가능

3. **중요도 기반 매칭**
   - essential: 필수 재료
   - optional: 선택적 재료
   - garnish: 장식용 재료

## 파일 구조 현황

```
fridge2fork/scrape/
├── app/
│   ├── db/                  # 데이터베이스 설정
│   ├── models/             # SQLAlchemy 모델
│   └── utils/              # 유틸리티 (재료 파서)
├── scripts/                # 실행 스크립트
│   ├── migrate_csv_data.py # CSV 마이그레이션
│   └── analyze_csv.py      # 데이터 분석
├── migrations/             # Alembic 마이그레이션
├── datas/                  # CSV 데이터 파일
├── docs/                   # 문서
└── main.py                 # 메인 애플리케이션
```

## 기술 스택

### 백엔드
- **Python 3.12+**: 메인 언어
- **SQLAlchemy**: ORM 및 데이터베이스 모델링
- **Alembic**: 데이터베이스 마이그레이션
- **AsyncPG**: 비동기 PostgreSQL 드라이버
- **Pandas**: CSV 데이터 처리

### 데이터베이스
- **PostgreSQL**: 메인 데이터베이스
- **GIN 인덱스**: 전문검색 지원
- **JSONB**: 메타데이터 저장 (필요시)

### 데이터 처리
- **정규표현식**: 재료 텍스트 파싱
- **한국어 처리**: 단위, 수량, 모호 표현 처리
- **Chardet**: 파일 인코딩 자동 감지

## 성공 기준

1. **데이터 품질**
   - CSV 데이터 100% 마이그레이션 성공
   - 재료 파싱 정확도 95% 이상
   - 중복 데이터 0건

2. **성능**
   - 33만개 레시피 처리 시간 < 2시간
   - 재료 검색 응답 시간 < 500ms
   - 동시 사용자 100명 지원

3. **기능**
   - 재료 기반 레시피 검색 정확도 90% 이상
   - 모호한 표현 적절 처리
   - 대체 재료 제안 기능

## 다음 단계

1. **Phase 2**: 데이터베이스 스키마 생성
2. **Phase 3**: CSV 데이터 마이그레이션 실행
3. **완료**: 단순한 데이터 마이그레이션 시스템 구축 완료