{% extends "layout.html" %}

{% block content %}
<div class="container-xl">
    <div class="page-header d-print-none">
        <div class="row align-items-center">
            <div class="col">
                <h2 class="page-title">
                    <i class="fa-solid fa-upload me-2"></i>
                    CSV 파일 업로드
                </h2>
                <div class="text-muted mt-1">레시피 CSV 파일을 업로드하여 임포트 배치를 생성합니다</div>
            </div>
        </div>
    </div>

    <div class="row row-cards mt-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">파일 선택</h3>
                </div>
                <div class="card-body">
                    {% if error_message %}
                    <div class="alert alert-danger" role="alert">
                        <i class="fa-solid fa-circle-exclamation me-2"></i>
                        {{ error_message }}
                    </div>
                    {% endif %}

                    {% if upload_result %}
                    <div class="alert alert-success" role="alert">
                        <h4 class="alert-heading">
                            <i class="fa-solid fa-circle-check me-2"></i>
                            업로드 성공!
                        </h4>
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>배치 ID:</strong> {{ upload_result.batch_id }}</p>
                                <p><strong>파일명:</strong> {{ upload_result.filename }}</p>
                                <p><strong>총 행 수:</strong> {{ upload_result.total_rows }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>처리된 행:</strong> {{ upload_result.processed_rows }}</p>
                                <p><strong>성공:</strong> <span class="text-success">{{ upload_result.success_count }}</span></p>
                                <p><strong>실패:</strong> <span class="text-danger">{{ upload_result.error_count }}</span></p>
                            </div>
                        </div>
                        <hr>
                        <a href="/fridge2fork/admin/import-batch/details/?pk={{ upload_result.batch_id }}" class="btn btn-primary">
                            <i class="fa-solid fa-eye me-2"></i>
                            배치 상세 보기
                        </a>
                        <a href="/fridge2fork/admin/pending-ingredient/list" class="btn btn-info">
                            <i class="fa-solid fa-carrot me-2"></i>
                            재료 검토하기
                        </a>
                    </div>
                    {% endif %}

                    <form method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label" for="csv_file">
                                <i class="fa-solid fa-file-csv me-2"></i>
                                CSV 파일
                            </label>
                            <input type="file"
                                   class="form-control"
                                   id="csv_file"
                                   name="csv_file"
                                   accept=".csv"
                                   required>
                        </div>

                        <div class="mb-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="fa-solid fa-upload me-2"></i>
                                업로드
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">CSV 형식 안내</h3>
                </div>
                <div class="card-body">
                    <h4>필수 컬럼</h4>
                    <ul class="list-unstyled">
                        <li><code>rcp_ttl</code> - 레시피 제목</li>
                        <li><code>ckg_mtrl_cn</code> - 재료 정보</li>
                    </ul>

                    <h4 class="mt-3">선택 컬럼</h4>
                    <ul class="list-unstyled text-muted small">
                        <li><code>ckg_nm</code> - 요리 종류</li>
                        <li><code>ckg_inbun_nm</code> - 인분</li>
                        <li><code>ckg_dodf_nm</code> - 난이도</li>
                        <li><code>rcp_img_url</code> - 이미지 URL</li>
                    </ul>

                    <h4 class="mt-3">처리 과정</h4>
                    <ol class="small">
                        <li>CSV 파일 파싱</li>
                        <li>재료 자동 정규화</li>
                        <li>카테고리 자동 분류</li>
                        <li>중복 재료 감지</li>
                        <li>승인 대기 상태로 저장</li>
                    </ol>

                    <div class="alert alert-info mt-3">
                        <i class="fa-solid fa-info-circle me-2"></i>
                        <small>업로드 후 <strong>Pending Ingredients</strong>에서 재료를 검토하고 승인하세요.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
